{% extends 'base.html' %}
{% block title %}{{ tournament.tournament_name|striptags|safe }}{% endblock %}
{% load auth_extras %}
{% load comment_tags %}
{% block js %}
<script>
  const goBack = () => {
    window.history.go(-1);
  };
</script>
{% endblock %}
{% block content %}
<div class="container">
  <br>
  <div class="d-flex">
    <h1 class="flex-grow-1"><u>{{ tournament.tournament_name | safe }}</u></h1>
    {% if request.user|in_group:"execs" %}
    <a class="px-2" href="{% url 'update-tournament' pk=tournament.pk %}">
    <i class="bi bi-pencil"></i>
    </a>
    <a class="px-2 text-danger" href="{% url 'delete-tournament' pk=tournament.pk %}">
    <i class="bi bi-trash"></i>
    </a>
    {% endif %}
  </div>
  <h5>Tournament link: <a href="{{ tournament.tournament_link }}">{{ tournament.tournament_link }}</a></h5>
  <h5>Tournament date: {{ tournament.tournament_date }}</h5>
  <p>{{ tournament.tournament_description | safe }}</p>
  <br>
  <div class="border border-2 rounded-2">
    <div class="p-3">
      <h4 class="text-muted">Results</h4>
      Participants: {% if number_of_participants %}{{ number_of_participants }}{% else %}N/A{% endif %}
      <br>
      Description: {% if description %}{{ description }}{% else %}N/A{% endif %}
      <br>
      Minutes: {% if minutes %}{{ minutes }}{% else %}N/A{% endif %}
      <br>
      Variant: {% if variant %}{{ variant }}{% else %}N/A{% endif %}
      <br>
      <div class="h6">Winner: {% if winner %}{{ winner }} ðŸŽ‰{% else %}There's no winner yet{% endif %}</div>
      <br>
      <br>
      {% if has_data_for_graph %}
        <canvas id="myChart" style="width: 200px; height: 200px;"></canvas>
      {% else %}
      <div class="text-center">
        <p class="fs-4">No graph can be generated from the data yet.</p>
      </div>
      {% endif %}
      <br>
      <br>
      <small class="text-muted">Note: This section is autogenerated</small>
    </div>
  </div>
  <div class="py-3">
    <button onclick="goBack()" class="btn btn-primary">
    Go Back
    </button>
  </div>
  <br>
  <hr style="height: 2px;">
  {% render_comments tournament request %}
</div>
<script>
var ctx = document.getElementById('myChart');
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [{% if labels_rankings %}{{ labels_rankings|safe }}{% endif %}],
      
        datasets: [{
            label: 'Score',
            data: [{% for name, score in participants_ranking.items %}{{score}},{% endfor %}],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
{% endblock %}